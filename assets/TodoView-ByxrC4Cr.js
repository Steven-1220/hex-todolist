import{r as l,f as _,g as L,c as d,b as j,h as F,a as e,i as n,t as y,j as $,v as b,n as k,F as B,k as R,o as v,L as A,l as q,u as G}from"./index-0bZXab50.js";import{a as f}from"./axios-CCb-kr4I.js";import{S as C}from"./sweetalert2.esm.all-BGf-Fe8G.js";const H={id:"todoListPage",class:"bg-half"},J={class:"todo_sm"},Q={class:"container todoListPage vhContainer"},W={class:"todoList_Content"},X={class:"inputBox"},Y={class:"todoList_list"},Z={class:"todoList_tab"},tt={class:"todoList_items"},et={key:0,class:"fs-3"},ot={key:1,class:"todoList_item"},st={key:0,class:"w-100 d-flex"},nt={key:1,class:"d-flex w-100"},at={class:"todoList_label"},lt=["onUpdate:modelValue","onClick"],it=["onClick"],rt=["onClick"],ut={class:"todoList_statistics"},p="https://todolist-api.hexschool.io",pt={__name:"TodoView",setup(ct){const h=l(!1),D=l(!0),z=()=>{h.value=!0,setTimeout(()=>{h.value=!1},1e3)};_(()=>{z()});const i=l(""),x=G(),w=l({uid:"",nickname:""}),I=async()=>{const o=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoListToken\s*=\s*([^;]*).*$)|^.*$/,"$1");i.value=o;try{const t=await f.get(`${p}/users/checkout`,{headers:{authorization:i.value}});w.value=t.data,g()}catch{C.fire({title:"驗證失效",icon:"error",text:"將導回登入頁面",confirmButtonText:"OK",confirmButtonColor:"#d71c1c"}),x.push("/"),setTimeout(()=>{x.push("/")},500)}};_(async()=>{I()});const O=l(""),V=async()=>{try{const o=await f.post(`${p}/users/sign_out`,{},{headers:{authorization:i.value}});O.value=o.data.message,C.fire({title:`${o.data.message}`,icon:"success",text:"將回到登入頁面",confirmButtonText:"OK",confirmButtonColor:"#ffd370"}),x.push("/")}catch(o){alert(o.response.data.message)}},r=l([]),g=async()=>{try{const o=await f.get(`${p}/todos/`,{headers:{authorization:i.value}});r.value=o.data.data}catch(o){console.log(o.response)}},m=l({content:""}),E=async()=>{if(m.value.content.trim()===""){C.fire({title:"待辦事項不能是空的",icon:"warning",confirmButtonText:"OK",confirmButtonColor:"#ffd370"});return}try{const o=await f.post(`${p}/todos/`,m.value,{headers:{authorization:i.value}});console.log(o),g(),m.value={content:""}}catch(o){console.log(o.response)}},S=async o=>{if((await C.fire({title:"確認是否要刪除?",text:"刪除後無法回復",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d71c1c",confirmButtonText:"刪除",cancelButtonText:"取消"})).isConfirmed)try{await f.delete(`${p}/todos/${o}`,{headers:{authorization:i.value}}),g()}catch(s){console.log(s.response)}},u=l({id:"",content:""}),U=async o=>{const t=r.value.findIndex(s=>s.id===o);u.value.id=o,u.value.content=r.value[t].content},M=async o=>{try{const t=await f.put(`${p}/todos/${o}`,{content:u.value.content},{headers:{authorization:i.value}});console.log(t),T(),g()}catch(t){console.log(t.response)}},T=()=>{u.value={}},N=async o=>{try{const t=await f.patch(`${p}/todos/${o}/toggle`,{},{headers:{authorization:i.value}});console.log(t.data)}catch(t){console.log(t.response)}},a=l("all"),K=L(()=>a.value==="all"?r.value:a.value==="incomplete"?r.value.filter(o=>o.status===!1):r.value.filter(o=>o.status===!0)),P=L(()=>r.value.filter(t=>t.status===!0).length);return(o,t)=>(v(),d(B,null,[j(F(A),{active:h.value,"onUpdate:active":t[0]||(t[0]=s=>h.value=s),"is-full-page":D.value},null,8,["active","is-full-page"]),e("div",H,[e("nav",null,[t[11]||(t[11]=e("h1",null,[e("a",{href:"#"},"ONLINE TODO LIST")],-1)),e("ul",null,[e("li",J,[e("a",{href:"#",onClick:t[1]||(t[1]=n(s=>a.value="all",["prevent"]))},[e("span",null,y(w.value.nickname)+"的代辦",1)])]),e("li",null,[e("a",{href:"#",onClick:t[2]||(t[2]=n(s=>V(),["prevent"]))},"登出")])])]),e("div",Q,[e("div",W,[e("div",X,[$(e("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":t[3]||(t[3]=s=>m.value.content=s)},null,512),[[b,m.value.content]]),e("a",{href:"#",class:"d-flex align-items-center justify-content-center",onClick:t[4]||(t[4]=n(s=>E(),["prevent"]))},t[12]||(t[12]=[e("i",{class:"fa fa-plus"},null,-1)]))]),e("div",Y,[e("ul",Z,[e("li",null,[e("a",{href:"#",class:k({active:a.value==="all"}),onClick:t[5]||(t[5]=n(s=>a.value="all",["prevent"]))},"全部",2)]),e("li",null,[e("a",{href:"#",class:k({active:a.value==="incomplete"}),onClick:t[6]||(t[6]=n(s=>a.value="incomplete",["prevent"]))},"待完成",2)]),e("li",null,[e("a",{href:"#",class:k({active:a.value==="done"}),onClick:t[7]||(t[7]=n(s=>a.value="done",["prevent"]))},"已完成",2)])]),e("div",tt,[r.value.length===0?(v(),d("h2",et,"目前尚無待辦事項")):(v(),d("ul",ot,[(v(!0),d(B,null,R(K.value,s=>(v(),d("li",{key:s.id},[u.value.id===s.id?(v(),d("div",st,[$(e("input",{class:"form-control",type:"text","onUpdate:modelValue":t[8]||(t[8]=c=>u.value.content=c)},null,512),[[b,u.value.content,void 0,{trim:!0}]]),e("button",{href:"#",class:"btn btn-sm btn-warning text-nowrap mx-2",onClick:t[9]||(t[9]=n(c=>M(u.value.id),["prevent"]))}," 確認 "),e("button",{href:"#",class:"btn btn-sm btn-danger text-nowrap",onClick:t[10]||(t[10]=n(c=>T(),["prevent"]))}," 取消 ")])):(v(),d("div",nt,[e("label",at,[$(e("input",{class:"todoList_input",type:"checkbox","onUpdate:modelValue":c=>s.status=c,onClick:c=>N(s.id)},null,8,lt),[[q,s.status]]),e("span",{class:k({"text-decoration-line-through":s.status})},y(s.content),3)]),e("a",{href:"#",onClick:n(c=>U(s.id),["prevent"])},t[13]||(t[13]=[e("i",{class:"bi bi-pencil"},null,-1)]),8,it),e("a",{href:"#",onClick:n(c=>S(s.id),["prevent"])},t[14]||(t[14]=[e("i",{class:"fa fa-times"},null,-1)]),8,rt)]))]))),128))])),e("div",ut,[e("p",null,y(P.value)+"個已完成項目",1)])])])])])])],64))}};export{pt as default};
